<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>vCenter MCP ‚Äî How It Works (Mac Local v1)</title>
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }

    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
      background: #0f1117;
      color: #e2e8f0;
      line-height: 1.7;
    }

    /* ‚îÄ‚îÄ Hero ‚îÄ‚îÄ */
    .hero {
      background: linear-gradient(135deg, #1a1f35 0%, #0f1117 60%);
      border-bottom: 1px solid #2d3748;
      padding: 60px 40px 50px;
      text-align: center;
    }
    .hero h1 {
      font-size: 2.4rem;
      font-weight: 700;
      background: linear-gradient(90deg, #7c85f5, #a78bfa, #38bdf8);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      margin-bottom: 12px;
    }
    .hero p {
      color: #94a3b8;
      font-size: 1.05rem;
      max-width: 600px;
      margin: 0 auto;
    }
    .badge {
      display: inline-block;
      background: #1e293b;
      border: 1px solid #334155;
      border-radius: 20px;
      padding: 4px 14px;
      font-size: 0.78rem;
      color: #7c85f5;
      margin-bottom: 20px;
      letter-spacing: 0.05em;
      text-transform: uppercase;
    }

    /* ‚îÄ‚îÄ Layout ‚îÄ‚îÄ */
    .container {
      max-width: 900px;
      margin: 0 auto;
      padding: 50px 30px;
    }

    /* ‚îÄ‚îÄ Section ‚îÄ‚îÄ */
    .section {
      margin-bottom: 60px;
    }
    .section-label {
      font-size: 0.72rem;
      text-transform: uppercase;
      letter-spacing: 0.12em;
      color: #7c85f5;
      margin-bottom: 10px;
    }
    .section h2 {
      font-size: 1.6rem;
      font-weight: 700;
      color: #f1f5f9;
      margin-bottom: 16px;
    }
    .section p {
      color: #94a3b8;
      margin-bottom: 14px;
      font-size: 0.97rem;
    }

    /* ‚îÄ‚îÄ Analogy card ‚îÄ‚îÄ */
    .analogy {
      background: #1e293b;
      border: 1px solid #334155;
      border-left: 4px solid #7c85f5;
      border-radius: 10px;
      padding: 20px 24px;
      margin: 20px 0;
      font-size: 0.95rem;
      color: #cbd5e1;
    }
    .analogy strong { color: #a78bfa; }

    /* ‚îÄ‚îÄ Highlight box ‚îÄ‚îÄ */
    .highlight {
      background: #0f2a1e;
      border: 1px solid #166534;
      border-radius: 10px;
      padding: 18px 22px;
      margin: 18px 0;
      color: #86efac;
      font-size: 0.93rem;
    }
    .highlight.blue {
      background: #0c1e35;
      border-color: #1d4ed8;
      color: #93c5fd;
    }
    .highlight.amber {
      background: #1c1208;
      border-color: #92400e;
      color: #fcd34d;
    }

    /* ‚îÄ‚îÄ File cards ‚îÄ‚îÄ */
    .file-grid {
      display: grid;
      gap: 14px;
      margin-top: 20px;
    }
    .file-card {
      background: #1e293b;
      border: 1px solid #334155;
      border-radius: 12px;
      padding: 18px 22px;
      display: grid;
      grid-template-columns: auto 1fr;
      gap: 0 18px;
      align-items: start;
    }
    .file-card:hover { border-color: #4f46e5; }
    .file-icon {
      font-size: 1.5rem;
      line-height: 1;
      margin-top: 3px;
    }
    .file-name {
      font-family: "SF Mono", "Fira Code", monospace;
      font-size: 0.88rem;
      color: #38bdf8;
      margin-bottom: 4px;
    }
    .file-role {
      font-size: 0.78rem;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      color: #7c85f5;
      margin-bottom: 6px;
    }
    .file-desc {
      font-size: 0.9rem;
      color: #94a3b8;
    }
    .file-detail {
      font-size: 0.83rem;
      color: #64748b;
      margin-top: 6px;
    }

    /* ‚îÄ‚îÄ Flow diagram ‚îÄ‚îÄ */
    .flow {
      margin: 30px 0;
    }
    .flow-step {
      display: flex;
      align-items: flex-start;
      gap: 16px;
      margin-bottom: 8px;
      position: relative;
    }
    .flow-left {
      display: flex;
      flex-direction: column;
      align-items: center;
      min-width: 48px;
    }
    .flow-num {
      width: 36px;
      height: 36px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 700;
      font-size: 0.85rem;
      flex-shrink: 0;
    }
    .flow-line {
      width: 2px;
      flex: 1;
      min-height: 28px;
      background: #334155;
      margin-top: 4px;
    }
    .flow-body {
      background: #1e293b;
      border: 1px solid #334155;
      border-radius: 10px;
      padding: 14px 18px;
      flex: 1;
      margin-bottom: 8px;
    }
    .flow-body h4 {
      font-size: 0.95rem;
      color: #f1f5f9;
      margin-bottom: 5px;
    }
    .flow-body p {
      font-size: 0.86rem;
      color: #64748b;
      margin: 0;
    }
    .flow-body code {
      font-family: "SF Mono", "Fira Code", monospace;
      background: #0f172a;
      padding: 2px 7px;
      border-radius: 4px;
      font-size: 0.82rem;
      color: #38bdf8;
    }

    .c1 { background: #312e81; color: #a5b4fc; }
    .c2 { background: #1e3a5f; color: #7dd3fc; }
    .c3 { background: #164e35; color: #6ee7b7; }
    .c4 { background: #4a1d30; color: #f9a8d4; }
    .c5 { background: #433316; color: #fcd34d; }
    .c6 { background: #1e293b; color: #94a3b8; }

    /* ‚îÄ‚îÄ Architecture box ‚îÄ‚îÄ */
    .arch-box {
      background: #0f172a;
      border: 1px solid #1e3a5f;
      border-radius: 14px;
      padding: 30px;
      margin: 24px 0;
      font-family: "SF Mono", "Fira Code", monospace;
      font-size: 0.85rem;
    }
    .arch-row {
      display: flex;
      align-items: center;
      gap: 12px;
      margin: 8px 0;
    }
    .arch-box-inner {
      background: #1e293b;
      border: 1px solid #334155;
      border-radius: 8px;
      padding: 10px 18px;
      color: #e2e8f0;
      flex: 1;
      text-align: center;
    }
    .arch-box-inner span {
      display: block;
      font-size: 0.72rem;
      color: #64748b;
      margin-top: 3px;
    }
    .arch-arrow {
      color: #4f46e5;
      font-size: 1.1rem;
      flex-shrink: 0;
    }
    .arch-label {
      font-size: 0.72rem;
      color: #7c85f5;
      min-width: 90px;
      text-align: right;
    }

    /* ‚îÄ‚îÄ Code block ‚îÄ‚îÄ */
    .code-block {
      background: #0f172a;
      border: 1px solid #1e293b;
      border-radius: 10px;
      padding: 20px 22px;
      font-family: "SF Mono", "Fira Code", monospace;
      font-size: 0.82rem;
      color: #e2e8f0;
      overflow-x: auto;
      margin: 16px 0;
      line-height: 1.7;
    }
    .code-block .key { color: #f472b6; }
    .code-block .val { color: #86efac; }
    .code-block .comment { color: #475569; }
    .code-block .str { color: #fbbf24; }

    /* ‚îÄ‚îÄ Tools grid ‚îÄ‚îÄ */
    .tools-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
      gap: 10px;
      margin-top: 16px;
    }
    .tool-pill {
      background: #1e293b;
      border: 1px solid #334155;
      border-radius: 8px;
      padding: 10px 14px;
    }
    .tool-pill .tool-name {
      font-family: "SF Mono", "Fira Code", monospace;
      font-size: 0.8rem;
      color: #38bdf8;
      margin-bottom: 3px;
    }
    .tool-pill .tool-desc {
      font-size: 0.77rem;
      color: #64748b;
    }
    .tool-pill.action { border-left: 3px solid #f87171; }
    .tool-pill.query  { border-left: 3px solid #34d399; }

    /* ‚îÄ‚îÄ Divider ‚îÄ‚îÄ */
    .divider {
      border: none;
      border-top: 1px solid #1e293b;
      margin: 50px 0;
    }

    /* ‚îÄ‚îÄ Footer ‚îÄ‚îÄ */
    footer {
      text-align: center;
      padding: 30px;
      color: #334155;
      font-size: 0.82rem;
      border-top: 1px solid #1e293b;
    }

    /* ‚îÄ‚îÄ FAQ ‚îÄ‚îÄ */
    .faq-item {
      border: 1px solid #1e3a5f;
      border-radius: 12px;
      margin-bottom: 10px;
      overflow: hidden;
    }
    .faq-question {
      width: 100%;
      background: #1e293b;
      border: none;
      cursor: pointer;
      padding: 18px 22px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 14px;
      text-align: left;
      color: #f1f5f9;
      font-size: 0.97rem;
      font-weight: 600;
      font-family: inherit;
      transition: background 0.15s;
    }
    .faq-question:hover { background: #253347; }
    .faq-question.open  { background: #1a2744; border-bottom: 1px solid #1e3a5f; }
    .faq-chevron {
      font-size: 0.8rem;
      color: #7c85f5;
      flex-shrink: 0;
      transition: transform 0.2s;
    }
    .faq-question.open .faq-chevron { transform: rotate(180deg); }
    .faq-answer {
      display: none;
      padding: 20px 22px;
      background: #0f172a;
      font-size: 0.91rem;
      color: #94a3b8;
      line-height: 1.75;
    }
    .faq-answer.open { display: block; }
    .faq-answer p { margin-bottom: 12px; }
    .faq-answer p:last-child { margin-bottom: 0; }
    .faq-answer strong { color: #e2e8f0; }
    .faq-answer code {
      font-family: "SF Mono", "Fira Code", monospace;
      background: #1e293b;
      padding: 2px 7px;
      border-radius: 4px;
      font-size: 0.82rem;
      color: #38bdf8;
    }
    .faq-answer .mini-flow {
      background: #0f1117;
      border: 1px solid #1e3a5f;
      border-radius: 10px;
      padding: 16px 20px;
      font-family: "SF Mono", "Fira Code", monospace;
      font-size: 0.8rem;
      color: #64748b;
      line-height: 2;
      margin: 14px 0;
    }
    .faq-answer .mini-flow .step-you    { color: #a78bfa; }
    .faq-answer .mini-flow .step-claude { color: #38bdf8; }
    .faq-answer .mini-flow .step-mcp    { color: #34d399; }
    .faq-answer .mini-flow .step-server { color: #fbbf24; }
    .faq-answer .mini-flow .step-vc     { color: #f87171; }
    .faq-answer ul {
      margin: 10px 0 10px 18px;
      color: #94a3b8;
    }
    .faq-answer ul li { margin-bottom: 6px; }
    .faq-tag {
      display: inline-block;
      font-size: 0.7rem;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      padding: 2px 9px;
      border-radius: 20px;
      margin-right: 10px;
      flex-shrink: 0;
    }
    .tag-read   { background: #164e35; color: #6ee7b7; }
    .tag-action { background: #4a1d30; color: #f9a8d4; }
    .tag-how    { background: #312e81; color: #a5b4fc; }
  </style>
</head>
<body>

<div class="hero">
  <div class="badge">Mac Local ‚Äî Version 1</div>
  <h1>vCenter MCP ‚Äî How It Works</h1>
  <p>A plain-English walkthrough of MCP, stdio, the project files, and the full connection flow from Claude Desktop to your Melbourne vCenter.</p>
</div>

<div class="container">

  <!-- ‚îÄ‚îÄ SECTION 1: What is MCP ‚îÄ‚îÄ -->
  <div class="section">
    <div class="section-label">Section 1</div>
    <h2>What is MCP?</h2>

    <p>MCP stands for <strong>Model Context Protocol</strong>. It is a standard developed by Anthropic that defines how Claude can talk to external tools and systems.</p>

    <p>Without MCP, if you wanted Claude to check your vCenter, you would have to write custom code, figure out your own message format, and build the whole bridge yourself ‚Äî and it would only work for your specific setup.</p>

    <p>With MCP, there is a standard "plug" that any tool can implement. Once implemented, Claude automatically knows how to discover what the tool can do and how to call it.</p>

    <div class="analogy">
      <strong>Analogy ‚Äî USB:</strong> Before USB, every device (keyboard, mouse, printer) needed its own special port on your computer. USB created one universal standard. MCP does the same for AI tools ‚Äî one universal protocol so Claude can plug into anything that speaks it.
    </div>

    <p>In this project, <code style="background:#1e293b;padding:2px 7px;border-radius:4px;color:#38bdf8;font-size:0.9rem;">server.py</code> is the MCP server. It implements the protocol, registers its tools (list VMs, power on/off, etc.), and Claude Desktop automatically discovers and calls them.</p>

    <div class="highlight">
      MCP separates concerns cleanly: Claude handles the AI and natural language. Your MCP server handles the actual system ‚Äî in this case, vCenter. Neither needs to know how the other works internally.
    </div>
  </div>

  <hr class="divider" />

  <!-- ‚îÄ‚îÄ SECTION 2: What is stdio ‚îÄ‚îÄ -->
  <div class="section">
    <div class="section-label">Section 2</div>
    <h2>What is stdio?</h2>

    <p><strong>stdio</strong> stands for Standard Input / Output. It is the most basic way two programs communicate ‚Äî one writes to its output pipe, the other reads from its input pipe.</p>

    <div class="analogy">
      <strong>Analogy ‚Äî walkie-talkie:</strong> Imagine two people with walkie-talkies. Person A talks (writes to stdout), Person B listens (reads from stdin), and vice versa. They are connected, in real time, through a simple channel ‚Äî no internet, no servers, just a direct pipe.
    </div>

    <p>When Claude Desktop uses <strong>stdio transport</strong>, it spawns (starts) the MCP server as a child process on the same machine. Claude and the server talk through stdin/stdout pipes ‚Äî fast, local, no network needed.</p>

    <div class="highlight blue">
      <strong>stdio = local process.</strong> Claude Desktop launches server.py directly on your Mac. They communicate through pipes. No HTTP server is needed. This is the simplest possible setup.
    </div>

    <p>The alternative is <strong>SSE (Server-Sent Events)</strong> transport ‚Äî where the MCP server runs somewhere on the network and Claude connects to it over HTTP. That is the Docker/remote version and is covered in a future document.</p>

    <div style="display:grid;grid-template-columns:1fr 1fr;gap:14px;margin-top:20px;">
      <div style="background:#1e293b;border:1px solid #334155;border-radius:10px;padding:16px;">
        <div style="color:#34d399;font-weight:700;margin-bottom:8px;">stdio (this version)</div>
        <div style="font-size:0.85rem;color:#64748b;">Server runs locally on your Mac<br>Claude spawns it as a process<br>Communication via pipes<br>No port, no HTTP</div>
      </div>
      <div style="background:#1e293b;border:1px solid #334155;border-radius:10px;padding:16px;">
        <div style="color:#38bdf8;font-weight:700;margin-bottom:8px;">SSE (remote/Docker version)</div>
        <div style="font-size:0.85rem;color:#64748b;">Server runs on OCI / cloud<br>Claude connects via URL<br>Communication via HTTP<br>Needs port 8080 exposed</div>
      </div>
    </div>
  </div>

  <hr class="divider" />

  <!-- ‚îÄ‚îÄ SECTION 3: Project Files ‚îÄ‚îÄ -->
  <div class="section">
    <div class="section-label">Section 3</div>
    <h2>Project Files ‚Äî What Each One Does</h2>

    <p>The project lives at <code style="background:#1e293b;padding:2px 7px;border-radius:4px;color:#38bdf8;font-size:0.9rem;">/Users/kay/Documents/Chatgpt_Codex/vCenter_MCP/</code></p>

    <div class="file-grid">

      <div class="file-card">
        <div class="file-icon">üß†</div>
        <div>
          <div class="file-name">server.py</div>
          <div class="file-role">The MCP Server ‚Äî Heart of the project</div>
          <div class="file-desc">This is the only file that actually runs. It registers all the tools (list_vms, power_on_vm, etc.) using the FastMCP framework, connects to vCenter using the pyVmomi SDK when a tool is called, and speaks the MCP protocol so Claude can discover and invoke those tools.</div>
          <div class="file-detail">Uses stdio transport in this setup ‚Äî Claude Desktop spawns it as a local process and they communicate through pipes.</div>
        </div>
      </div>

      <div class="file-card">
        <div class="file-icon">üì¶</div>
        <div>
          <div class="file-name">requirements.txt</div>
          <div class="file-role">Python dependencies</div>
          <div class="file-desc">Lists the two Python packages server.py needs: <strong>mcp[cli]</strong> (the MCP framework that handles the protocol) and <strong>pyVmomi</strong> (VMware's official Python SDK for talking to vCenter). Both are installed via pip on your Mac.</div>
        </div>
      </div>

    </div>

    <p style="margin-top:24px;">Two additional files were created <strong>outside</strong> the project folder as part of this Mac local setup:</p>

    <div class="file-grid">

      <div class="file-card">
        <div class="file-icon">‚öôÔ∏è</div>
        <div>
          <div class="file-name">~/Library/Application Support/Claude/claude_desktop_config.json</div>
          <div class="file-role">Claude Desktop configuration</div>
          <div class="file-desc">Tells Claude Desktop that an MCP server called "vcenter" exists, how to start it (which Python binary and which script), and what environment variables to pass (credentials, host, port). Claude reads this on launch and spawns server.py automatically.</div>
        </div>
      </div>

      <div class="file-card">
        <div class="file-icon">üîó</div>
        <div>
          <div class="file-name">~/Library/LaunchAgents/com.vcenter.sshtunnel.plist</div>
          <div class="file-role">Persistent SSH tunnel (macOS launchd)</div>
          <div class="file-desc">A macOS background service definition that keeps an SSH tunnel alive at all times. It forwards local port 10443 ‚Üí OCI VM ‚Üí vCenter port 443. Starts automatically on login, restarts if it drops. Without this, server.py cannot reach the vCenter because 10.0.12.2 is not directly accessible from your Mac.</div>
        </div>
      </div>

    </div>
  </div>

  <hr class="divider" />

  <!-- ‚îÄ‚îÄ SECTION 4: Available Tools ‚îÄ‚îÄ -->
  <div class="section">
    <div class="section-label">Section 4</div>
    <h2>What server.py Exposes to Claude</h2>

    <p>server.py registers 13 tools. Claude automatically knows about all of them and calls the right one based on what you type. Green = read-only queries. Red border = actions that change state.</p>

    <div class="tools-grid">
      <div class="tool-pill query"><div class="tool-name">list_vms</div><div class="tool-desc">All VMs with power state, CPU, RAM, IP</div></div>
      <div class="tool-pill query"><div class="tool-name">get_vm_details</div><div class="tool-desc">Deep info on a specific VM by name</div></div>
      <div class="tool-pill query"><div class="tool-name">list_hosts</div><div class="tool-desc">All ESXi hosts with specs and state</div></div>
      <div class="tool-pill query"><div class="tool-name">get_host_performance</div><div class="tool-desc">CPU & memory usage for a host</div></div>
      <div class="tool-pill query"><div class="tool-name">list_datastores</div><div class="tool-desc">Storage capacity and free space</div></div>
      <div class="tool-pill query"><div class="tool-name">list_networks</div><div class="tool-desc">Port groups and networks</div></div>
      <div class="tool-pill query"><div class="tool-name">list_vm_snapshots</div><div class="tool-desc">Snapshots for a given VM</div></div>
      <div class="tool-pill query"><div class="tool-name">get_inventory_summary</div><div class="tool-desc">High-level counts across environment</div></div>
      <div class="tool-pill query"><div class="tool-name">get_alarms</div><div class="tool-desc">Any triggered alarms in vCenter</div></div>
      <div class="tool-pill action"><div class="tool-name">power_on_vm</div><div class="tool-desc">Powers on a VM by name</div></div>
      <div class="tool-pill action"><div class="tool-name">power_off_vm</div><div class="tool-desc">Powers off ‚Äî requires confirmation</div></div>
      <div class="tool-pill action"><div class="tool-name">restart_vm</div><div class="tool-desc">Restarts ‚Äî requires confirmation</div></div>
      <div class="tool-pill action"><div class="tool-name">create_vm_snapshot</div><div class="tool-desc">Creates a snapshot with a name</div></div>
    </div>
  </div>

  <hr class="divider" />

  <!-- ‚îÄ‚îÄ SECTION 5: Full Flow ‚îÄ‚îÄ -->
  <div class="section">
    <div class="section-label">Section 5</div>
    <h2>The Full Flow ‚Äî Step by Step</h2>

    <p>Here is exactly what happens from the moment you open Claude Desktop to the moment you get an answer about your VMs.</p>

    <!-- Architecture visual -->
    <div class="arch-box">
      <div class="arch-row">
        <div class="arch-label">Your Mac</div>
        <div class="arch-box-inner">Claude Desktop<span>Chat UI ‚Äî where you type</span></div>
        <div class="arch-arrow">‚Üï</div>
        <div class="arch-box-inner">server.py<span>MCP server ‚Äî spawned by Claude</span></div>
      </div>
      <div style="text-align:center;color:#334155;margin:4px 0 4px 100px;font-size:0.8rem;">‚Üï stdio pipe (same machine)</div>
      <div style="text-align:center;color:#334155;margin:4px 0 4px 100px;font-size:0.8rem;">‚Üï TCP to localhost:10443</div>
      <div class="arch-row">
        <div class="arch-label"></div>
        <div class="arch-box-inner" style="border-color:#4f46e5;background:#1a1f35;">SSH Tunnel (launchd)<span>localhost:10443 ‚Üí 158.179.16.118 ‚Üí 10.0.12.2:443</span></div>
      </div>
      <div style="text-align:center;color:#334155;margin:4px 0 4px 100px;font-size:0.8rem;">‚Üï SSH over internet</div>
      <div class="arch-row">
        <div class="arch-label">OCI Cloud</div>
        <div class="arch-box-inner">OCI VM (158.179.16.118)<span>Jump host ‚Äî just forwards the tunnel</span></div>
      </div>
      <div style="text-align:center;color:#334155;margin:4px 0 4px 100px;font-size:0.8rem;">‚Üï internal VCN network</div>
      <div class="arch-row">
        <div class="arch-label">Melbourne DC</div>
        <div class="arch-box-inner" style="border-color:#166534;background:#0f2a1e;">vCenter (10.0.12.2:443)<span>VMware vSphere API</span></div>
      </div>
    </div>

    <!-- Step-by-step flow -->
    <div class="flow">

      <div class="flow-step">
        <div class="flow-left">
          <div class="flow-num c1">1</div>
          <div class="flow-line"></div>
        </div>
        <div class="flow-body">
          <h4>Mac boots ‚Üí SSH tunnel starts automatically</h4>
          <p>macOS launchd reads <code>com.vcenter.sshtunnel.plist</code> and runs an SSH command that opens a persistent tunnel: <code>localhost:10443 ‚Üí opc@158.179.16.118 ‚Üí 10.0.12.2:443</code>. This runs silently in the background. If it drops, launchd restarts it. Your Mac now has a local port (10443) that is secretly connected all the way through to vCenter.</p>
        </div>
      </div>

      <div class="flow-step">
        <div class="flow-left">
          <div class="flow-num c2">2</div>
          <div class="flow-line"></div>
        </div>
        <div class="flow-body">
          <h4>Claude Desktop launches ‚Üí reads config</h4>
          <p>Claude Desktop opens <code>claude_desktop_config.json</code> and finds the vcenter MCP server entry. It sees the command is <code>/opt/homebrew/bin/python3.13</code> with the script <code>server.py</code>, and a set of environment variables including <code>VCENTER_HOST=127.0.0.1</code> and <code>VCENTER_PORT=10443</code>.</p>
        </div>
      </div>

      <div class="flow-step">
        <div class="flow-left">
          <div class="flow-num c3">3</div>
          <div class="flow-line"></div>
        </div>
        <div class="flow-body">
          <h4>Claude Desktop spawns server.py as a child process</h4>
          <p>Claude runs <code>python3.13 server.py</code> on your Mac, passing those environment variables into it. server.py starts up using <strong>stdio transport</strong> ‚Äî meaning it listens on its stdin for MCP messages from Claude and writes responses to stdout. No HTTP port is opened. They talk through direct pipes.</p>
        </div>
      </div>

      <div class="flow-step">
        <div class="flow-left">
          <div class="flow-num c4">4</div>
          <div class="flow-line"></div>
        </div>
        <div class="flow-body">
          <h4>Claude discovers the tools via MCP handshake</h4>
          <p>Claude sends an <code>initialize</code> message over the pipe. server.py responds with its capabilities. Claude then sends a <code>tools/list</code> request and gets back all 13 tools with their names, descriptions, and expected parameters. Claude now knows what it can do with vCenter ‚Äî without you doing anything.</p>
        </div>
      </div>

      <div class="flow-step">
        <div class="flow-left">
          <div class="flow-num c5">5</div>
          <div class="flow-line"></div>
        </div>
        <div class="flow-body">
          <h4>You type a question ‚Äî Claude decides which tool to call</h4>
          <p>You type <em>"how many VMs are powered off?"</em> Claude's AI understands this requires VM data and decides to call the <code>list_vms</code> tool. It sends a <code>tools/call</code> MCP message to server.py with the tool name and any parameters.</p>
        </div>
      </div>

      <div class="flow-step">
        <div class="flow-left">
          <div class="flow-num c6">6</div>
          <div class="flow-line"></div>
        </div>
        <div class="flow-body">
          <h4>server.py connects to vCenter through the tunnel</h4>
          <p>server.py calls <code>SmartConnect(host="127.0.0.1", port=10443)</code> using pyVmomi. This TCP connection hits the SSH tunnel on your Mac, which carries it to the OCI VM over the internet, which then forwards it on the internal network to vCenter at <code>10.0.12.2:443</code>. vCenter receives an authenticated vSphere API call and returns VM data.</p>
        </div>
      </div>

      <div class="flow-step">
        <div class="flow-left">
          <div class="flow-num c1">7</div>
        </div>
        <div class="flow-body">
          <h4>Result travels back ‚Üí Claude formats the answer</h4>
          <p>server.py receives the VM list from vCenter, formats it as JSON, and writes it back to stdout (the MCP pipe). Claude receives the data, counts the powered-off VMs, and writes a natural language answer in the chat. You see <em>"10 VMs are powered off: Centos8-rag, ra3‚Ä¶"</em></p>
        </div>
      </div>

    </div>
  </div>

  <hr class="divider" />

  <!-- ‚îÄ‚îÄ SECTION 6: Config walkthrough ‚îÄ‚îÄ -->
  <div class="section">
    <div class="section-label">Section 6</div>
    <h2>The claude_desktop_config.json ‚Äî Line by Line</h2>

    <div class="code-block">
<span class="comment">// ~/Library/Application Support/Claude/claude_desktop_config.json</span>
{
  <span class="key">"mcpServers"</span>: {
    <span class="key">"vcenter"</span>: {                       <span class="comment">// name shown in Claude Desktop settings</span>

      <span class="key">"command"</span>: <span class="str">"/opt/homebrew/bin/python3.13"</span>,
      <span class="comment">// full path to Python ‚Äî Claude Desktop has a limited PATH,</span>
      <span class="comment">// so we must use the absolute path, not just "python3"</span>

      <span class="key">"args"</span>: [<span class="str">"/Users/kay/Documents/Chatgpt_Codex/vCenter_MCP/server.py"</span>],
      <span class="comment">// the script to run ‚Äî absolute path required</span>

      <span class="key">"env"</span>: {
        <span class="key">"VCENTER_HOST"</span>: <span class="str">"127.0.0.1"</span>,
        <span class="comment">// NOT the real vCenter IP ‚Äî points to localhost</span>
        <span class="comment">// because the SSH tunnel receives on localhost</span>

        <span class="key">"VCENTER_USERNAME"</span>: <span class="str">"administrator@vsphere.local"</span>,
        <span class="key">"VCENTER_PASSWORD"</span>: <span class="str">"***"</span>,

        <span class="key">"VCENTER_PORT"</span>: <span class="str">"10443"</span>,
        <span class="comment">// NOT 443 ‚Äî the SSH tunnel listens on 10443 locally</span>
        <span class="comment">// and forwards to vCenter's real port 443 on the other end</span>

        <span class="key">"VCENTER_SSL_VERIFY"</span>: <span class="str">"false"</span>
        <span class="comment">// vCenter uses a self-signed cert ‚Äî skip verification</span>
      }
    }
  }
}
    </div>

    <div class="highlight amber">
      The key insight: <strong>VCENTER_HOST is 127.0.0.1 and PORT is 10443</strong> ‚Äî not the real vCenter address. server.py thinks it is talking to something on your own Mac. The SSH tunnel silently carries that traffic all the way to Melbourne.
    </div>
  </div>



  <hr class="divider" />

  <!-- ‚îÄ‚îÄ SECTION 7: FAQ ‚îÄ‚îÄ -->
  <div class="section">
    <div class="section-label">Section 7</div>
    <h2>Frequently Asked Questions</h2>
    <p>Common questions about using Claude Desktop to manage vCenter from chat.</p>

    <!-- Q1 -->
    <div class="faq-item">
      <button class="faq-question" onclick="toggleFaq(this)">
        <span><span class="faq-tag tag-how">How</span>What actually happens when I type "list datastores" in Claude Desktop?</span>
        <span class="faq-chevron">‚ñº</span>
      </button>
      <div class="faq-answer">
        <p>Your plain-English message goes through several layers before vCenter is touched. Here is the exact sequence:</p>
        <div class="mini-flow">
          <span class="step-you">You</span> ‚Üí type "list datastores" in Claude Desktop chat<br>
          &nbsp;&nbsp;‚Üì<br>
          <span class="step-claude">Claude AI (Anthropic servers)</span> ‚Üí reads your message, decides to call <code>list_datastores()</code><br>
          &nbsp;&nbsp;‚Üì MCP protocol over stdio pipe<br>
          <span class="step-server">server.py (your Mac)</span> ‚Üí receives tool call, runs <code>list_datastores()</code><br>
          &nbsp;&nbsp;‚Üì pyVmomi HTTPS call to localhost:10443<br>
          <span class="step-mcp">SSH Tunnel (launchd)</span> ‚Üí forwards connection ‚Üí OCI VM ‚Üí vCenter 10.0.12.2:443<br>
          &nbsp;&nbsp;‚Üì<br>
          <span class="step-vc">vCenter</span> ‚Üí authenticates, queries datastore inventory, returns data<br>
          &nbsp;&nbsp;‚Üì back up the same chain<br>
          <span class="step-server">server.py</span> ‚Üí formats result as JSON<br>
          &nbsp;&nbsp;‚Üì MCP pipe<br>
          <span class="step-claude">Claude AI</span> ‚Üí reads JSON, writes human-readable answer<br>
          &nbsp;&nbsp;‚Üì<br>
          <span class="step-you">You</span> ‚Üí see "Here are your datastores‚Ä¶"
        </div>
        <p><strong>Key point:</strong> Claude never talks directly to vCenter. Your <code>server.py</code> is the only thing that touches vCenter ‚Äî Claude only calls your MCP tools.</p>
      </div>
    </div>

    <!-- Q2 -->
    <div class="faq-item">
      <button class="faq-question" onclick="toggleFaq(this)">
        <span><span class="faq-tag tag-read">Read</span>What read-only queries can I run from chat?</span>
        <span class="faq-chevron">‚ñº</span>
      </button>
      <div class="faq-answer">
        <p>These queries only read data ‚Äî they never change anything in vCenter:</p>
        <ul>
          <li><strong>List all VMs</strong> ‚Äî power state, CPU, RAM, IP for every VM<br><em>"List all VMs" / "Show me all virtual machines"</em></li>
          <li><strong>Get VM details</strong> ‚Äî deep info on one VM by name<br><em>"Get details for &lt;vm-name&gt;"</em></li>
          <li><strong>List all ESXi hosts</strong> ‚Äî connection state, cores, RAM, model, version<br><em>"List all hosts"</em></li>
          <li><strong>Get host performance</strong> ‚Äî live CPU and memory utilisation<br><em>"Show CPU and memory usage for host &lt;host-name&gt;"</em></li>
          <li><strong>List datastores</strong> ‚Äî capacity, free space, used space, type<br><em>"List datastores" / "How much free storage do I have?"</em></li>
          <li><strong>List networks</strong> ‚Äî all port groups and networks<br><em>"Show all networks"</em></li>
          <li><strong>List VM snapshots</strong> ‚Äî snapshots for a named VM<br><em>"List snapshots for &lt;vm-name&gt;"</em></li>
          <li><strong>Inventory summary</strong> ‚Äî total VMs, powered on/off counts, host and datastore counts<br><em>"Give me an overview of the environment"</em></li>
          <li><strong>Get active alarms</strong> ‚Äî any triggered alarms across the environment<br><em>"Are there any active alarms?"</em></li>
        </ul>
      </div>
    </div>

    <!-- Q3 -->
    <div class="faq-item">
      <button class="faq-question" onclick="toggleFaq(this)">
        <span><span class="faq-tag tag-action">Action</span>What actions can I take that change VM state?</span>
        <span class="faq-chevron">‚ñº</span>
      </button>
      <div class="faq-answer">
        <p>These operations actually change something in vCenter. Use them carefully:</p>
        <ul>
          <li><strong>Power on a VM</strong> ‚Äî starts a powered-off VM<br><em>"Power on &lt;vm-name&gt;"</em></li>
          <li><strong>Power off a VM</strong> ‚Äî hard stops a running VM (requires you to confirm)<br><em>"Power off &lt;vm-name&gt;" ‚Üí Claude will ask you to confirm</em></li>
          <li><strong>Restart a VM</strong> ‚Äî hard resets a running VM (requires confirmation)<br><em>"Restart &lt;vm-name&gt;" ‚Üí Claude will ask you to confirm</em></li>
          <li><strong>Create a VM snapshot</strong> ‚Äî takes a point-in-time snapshot<br><em>"Create a snapshot of &lt;vm-name&gt; named &lt;snap-name&gt;"</em></li>
        </ul>
        <p><strong>Safety note:</strong> Power off and restart require <code>confirm=True</code> in the tool call. Claude will prompt you to explicitly say "yes, confirm" before those tasks execute ‚Äî so you cannot accidentally shut down a VM.</p>
      </div>
    </div>

    <!-- Q4 -->
    <div class="faq-item">
      <button class="faq-question" onclick="toggleFaq(this)">
        <span><span class="faq-tag tag-how">How</span>Do my vCenter credentials ever leave my laptop?</span>
        <span class="faq-chevron">‚ñº</span>
      </button>
      <div class="faq-answer">
        <p><strong>No.</strong> Your credentials are stored only in <code>claude_desktop_config.json</code> on your Mac and are passed as environment variables to <code>server.py</code> when it starts.</p>
        <p>Claude Desktop (and the Claude AI model running on Anthropic's servers) never sees your username or password. The credentials only exist inside <code>server.py</code>'s process memory on your Mac, and are used exclusively to authenticate pyVmomi's connection to vCenter through the SSH tunnel.</p>
        <p>What does reach Anthropic's servers: only your chat messages and the JSON results that <code>server.py</code> returns (datastore names, VM names, etc.).</p>
      </div>
    </div>

    <!-- Q5 -->
    <div class="faq-item">
      <button class="faq-question" onclick="toggleFaq(this)">
        <span><span class="faq-tag tag-how">How</span>What is NOT supported yet?</span>
        <span class="faq-chevron">‚ñº</span>
      </button>
      <div class="faq-answer">
        <p>The following operations would require additional tools to be added to <code>server.py</code>:</p>
        <ul>
          <li>Creating, cloning, or deleting VMs</li>
          <li>Migrating VMs between hosts (vMotion)</li>
          <li>Reverting or deleting snapshots</li>
          <li>Resource pool and cluster management</li>
          <li>Viewing vCenter event or task history</li>
          <li>Managing vDS / distributed switch config</li>
          <li>Storage vMotion (moving VM disks between datastores)</li>
        </ul>
        <p>Each of these can be added by implementing a new <code>@mcp.tool()</code> function in <code>server.py</code> ‚Äî Claude will automatically discover and expose it the next time Claude Desktop is restarted.</p>
      </div>
    </div>

    <!-- Q6 -->
    <div class="faq-item">
      <button class="faq-question" onclick="toggleFaq(this)">
        <span><span class="faq-tag tag-how">How</span>What happens if the SSH tunnel drops mid-query?</span>
        <span class="faq-chevron">‚ñº</span>
      </button>
      <div class="faq-answer">
        <p>If the SSH tunnel is down when a tool is called, <code>server.py</code> will fail to connect to <code>localhost:10443</code> and return a connection error. Claude will show you the error message in chat.</p>
        <p><strong>macOS launchd</strong> (the background service defined in <code>com.vcenter.sshtunnel.plist</code>) automatically restarts the tunnel if it drops ‚Äî usually within a few seconds. Just retry your query and it should work.</p>
        <p>To manually check if the tunnel is alive, you can run <code>ssh -O check vcenter-tunnel</code> in Terminal, or simply ask Claude again ‚Äî if it works, the tunnel is up.</p>
      </div>
    </div>

  </div>

</div>

<script>
  function toggleFaq(btn) {
    const answer = btn.nextElementSibling;
    const isOpen = btn.classList.contains('open');
    // Close all
    document.querySelectorAll('.faq-question.open').forEach(b => {
      b.classList.remove('open');
      b.nextElementSibling.classList.remove('open');
    });
    // Open clicked (if it wasn't already open)
    if (!isOpen) {
      btn.classList.add('open');
      answer.classList.add('open');
    }
  }
</script>

<footer>
  vCenter MCP ‚Äî Mac Local Version 1 &nbsp;¬∑&nbsp; Generated 2026
</footer>

</body>
</html>
